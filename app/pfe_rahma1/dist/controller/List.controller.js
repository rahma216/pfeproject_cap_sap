sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/f/library","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,i,n,a){"use strict";return e.extend("app.pferahma1.controller.List",{onInit:function(){this._oTable=this.byId("table0")},_validateInputs:function(e){var t=this.getView().getModel("mainModel");var i=[];e.forEach(e=>{var n=e.getId().includes("ID")?"ID":"name";var a=e.getValue();var o=new Promise((i,o)=>{if(!a){e.setValueState("Error");e.setValueStateText("Ce champ est obligatoire et ne peut pas être vide.");i(true);return}var r=t.bindList("/Entity",undefined,undefined,[new sap.ui.model.Filter(n,sap.ui.model.FilterOperator.EQ,a)]);r.requestContexts().then(function(t){if(t&&t.length>0){e.setValueState("Error");e.setValueStateText("La valeur '"+a+"' pour '"+n+"' existe déjà.");i(true)}else{e.setValueState("None");i(false)}}).catch(function(t){e.setValueState("Error");e.setValueStateText("Erreur lors de la vérification de la valeur.");i(true)})});i.push(o)});return Promise.all(i)},onCreate:function(){var e=this.getView(),i=[e.byId("EntityID"),e.byId("EntityNamee")];this._validateInputs(i).then(e=>{var i=e.some(e=>e===true);if(!i){const e=this._oTable;const i=e.getBinding("items");i.create({ID:this.byId("EntityID").getValue(),name:this.byId("EntityNamee").getValue()});t.show("The input is validated. Your Entity has been Created.")}else{MessageBox.alert("A validation error has occurred.Check your Id and your EntityName")}}).catch(e=>{MessageBox.alert("An error occurred during the validation process.")})},onOpenAddDialog:function(){this.getView().byId("OpenDialog").open()},onCancelDialog:function(e){e.getSource().getParent().close()},onEditMode:function(){this.byId("editModeButton").setVisible(false);this.byId("saveButton").setVisible(true);this.byId("deleteButton").setVisible(true);this.rebindTable(this.oEditableTemplate,"Edit")},onDelete:function(){var e=this.byId("table0").getSelectedItem();if(e){var i=e.getBindingContext("mainModel").getObject().name;e.getBindingContext("mainModel").delete("$auto").then(function(){t.show(i+" SuccessFully Deleted")}.bind(this),function(e){t.show("Deletion Error: ",e)})}else{t.show("Please Select a Row to Delete")}},onListItemPress:function(e){var t=e.getSource();var i=t.getBindingContext("mainModel");var n=i.getObject();var a=this.getOwnerComponent().getModel("detailModel");a.setData(n);this.getOwnerComponent().getRouter().navTo("Details",{index:n.ID});var o=this.getOwnerComponent().getModel("localModel");o.setProperty("/layout","TwoColumnsMidExpanded")},filterEntityById:function(e){let t=this.getView().getModel();let i=new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.EQ,e);t.bindList("{mainModel>/Entity}",undefined,undefined,[i]).requestContexts().then(function(e){e.forEach(e=>{console.log(e.getObject())})})},onSearch:function(e){var t=[];var i=e.getSource().getValue();if(i&&i.length>0){var o=new n("name",a.Contains,i);t.push(o)}var r=this.byId("table0");var s=r.getBinding("items");s.filter(t,"Application")},onUpdate:function(){var e=this.getView().byId("table0").getSelectedItem();if(e){var i=e.getBindingContext("mainModel");if(i){var n=this.getView().byId("EntityName").getValue();i.setProperty("name",n);var a=this.getView().getModel("mainModel");a.submitBatch("yourGroupId").then(function(){t.show("Update successful")}).catch(function(e){t.show("Update failed: "+e.message)})}else{t.show("Invalid Entity Name")}}else{t.show("Please select a row to update")}}})});